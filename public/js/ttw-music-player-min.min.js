(function(b){b.fn.ttwMusicPlayer=function(C,N){var D=this,x,O,M,A,R,L,z,C,y,G,J,H;M={jPlayer:"#jquery_jplayer",jPlayerInterface:".jp-interface",playerPrevious:".jp-interface .jp-previous",playerNext:".jp-interface .jp-next",trackList:".tracklist",tracks:".tracks",track:".track",trackRating:".rating-bar",trackInfo:".track-info",rating:".rating",ratingLevel:".rating-level",ratingLevelOn:".on",title:".title",duration:".duration",buy:".buy",buyNotActive:".not-active",playing:".playing",moreButton:".more",player:".player",artist:".artist",artistOuter:".artist-outer",albumCover:".img",description:".description",descriptionShowing:".showing"};x={ratingCallback:null,currencySymbol:"$",buyText:"BUY",tracksToShow:4,autoPlay:false,jPlayer:{}};O=b.extend(true,{},x,N);J=C;H=0;A=function(){C=new R();y=new L();y.buildInterface();C.init(O.jPlayer);D.bind("mbPlaylistLoaded",function(){D.bind("mbInterfaceBuilt",function(){G=new z()});y.init()})};R=function(){var t=false,e,n={},c,r=0,p=0,v,o;e={listItem:'<li class="track"><span class="title"></span><span class="duration"></span><span class="rating"></span><a href="#" class="buy not-active" target="_blank"></a></li>',ratingBar:'<span class="rating-level rating-bar"></span>'};function h(w){n=b(".ttw-music-player .jPlayer-container");var U,V;U={swfPath:"jquery-jplayer",supplied:"mp3, oga",cssSelectorAncestor:M.jPlayerInterface,errorAlerts:false,warningAlerts:false};V=b.extend(true,{},U,w);n.bind(b.jPlayer.event.ready,function(){n.bind(b.jPlayer.event.ended,function(S){j()});n.bind(b.jPlayer.event.play,function(S){n.jPlayer("pauseOthers");c.eq(H).addClass(F(M.playing)).siblings().removeClass(F(M.playing))});n.bind(b.jPlayer.event.playing,function(S){t=true});n.bind(b.jPlayer.event.pause,function(S){t=false});b(M.playerPrevious).click(function(){l();b(this).blur();return false});b(M.playerNext).click(function(){j();b(this).blur();return false});D.bind("mbInitPlaylistAdvance",function(T){var S=this.getData("mbInitPlaylistAdvance");if(S!=H){H=S;f(H)}else{if(!n.data("jPlayer").status.srcSet){f(0)}else{s()}}});i();D.trigger("mbPlaylistLoaded");u(function(){j();b(this).blur();return false})});n.jPlayer(V)}function u(w){H=0;if(w){f(H)}else{k(H);D.trigger("mbPlaylistInit")}}function k(w){H=w;n.jPlayer("setMedia",J[H])}function f(w){k(w);if(w>=O.tracksToShow){g()}D.trigger("mbPlaylistAdvance");n.jPlayer("play")}function j(){var w=(H+1<J.length)?H+1:0;f(w)}function l(){var w=(H-1>=0)?H-1:J.length-1;f(w)}function s(){if(!t){n.jPlayer("play")}else{n.jPlayer("pause")}}function i(){var Z=b();v=D.find(M.tracks);for(var X=0;X<5;X++){Z=Z.add(e.ratingBar)}for(var Y=0;Y<J.length;Y++){var w=b(e.listItem);w.find(M.rating).html(Z.clone());w.find(M.title).html(K(Y));w.find(M.duration).html(m(Y));P("track",w,Y);q(w,Y);w.data("index",Y);v.append(w)}c=b(M.track);c.slice(0,O.tracksToShow).each(function(){r+=b(this).outerHeight()});c.slice(O.tracksToShow,J.length).each(function(){p+=b(this).outerHeight()});if(p>0){var W=b(M.trackList);v.height(r);W.addClass("show-more-button");W.find(M.moreButton).click(function(){o=b(this);g()})}c.find(".title").click(function(){f(b(this).parents("li").data("index"))})}function g(){if(Q(o)){o=D.find(M.moreButton)}v.animate({height:r+p},function(){o.animate({opacity:0},function(){o.slideUp(function(){o.parents(M.trackList).removeClass("show-more-button");o.remove()})})})}function m(w){return !Q(J[w].duration)?J[w].duration:"-"}function q(w,T){if(!Q(J[T].buy)){w.find(M.buy).removeClass(F(M.buyNotActive)).attr("href",J[T].buy).html(d(T))}}function d(w){return(!Q(J[w].price)?O.currencySymbol+J[w].price:"")+" "+O.buyText}return{init:h,playlistInit:u,playlistAdvance:f,playlistNext:j,playlistPrev:l,togglePlay:s,$myJplayer:n}};z=function(){var c=D.find(M.track);function d(){b(M.rating).find(M.ratingLevel).hover(function(){b(this).addClass("hover").prevAll().addClass("hover").end().nextAll().removeClass("hover")});b(M.rating).mouseleave(function(){b(this).find(M.ratingLevel).removeClass("hover")});b(M.ratingLevel).click(function(){var g=b(this),h=g.parent().children().index(g)+1,f;if(g.hasClass(F(M.trackRating))){h=h/1;f=g.parents("li").data("index");if(f==H){I(h)}}else{f=H;E(c.eq(f),h)}g.prevAll().add(g).addClass(F(M.ratingLevelOn)).end().end().nextAll().removeClass(F(M.ratingLevelOn));e(f,h)})}function e(f,g){J[f].rating=g;B(O.ratingCallback,f,J[f],g)}d()};L=function(){var f,l,j,h;function k(){f=b(M.player),l=f.find(M.title),j=f.find(M.artist),h=f.find(M.albumCover);d();D.bind("mbPlaylistAdvance mbPlaylistInit",function(){g();i();P("current",null,H);e()})}function c(){var n,m;n='<div class="ttw-music-player"><div class="player jp-interface"><div class="album-cover"><span class="img"></span>            <span class="highlight"></span>        </div>        <div class="track-info">            <p class="title"></p>            <p class="artist-outer">By <span class="artist"></span></p>            <div class="rating">                <span class="rating-level rating-star"></span>                <span class="rating-level rating-star on"></span>                <span class="rating-level rating-star on"></span>                <span class="rating-level rating-star on"></span>                <span class="rating-level rating-star"></span>            </div>        </div>        <div class="player-controls">            <div class="main">                <div class="previous jp-previous"></div>                <div class="play jp-play"></div>                <div class="pause jp-pause"></div>                <div class="next jp-next"></div><!-- These controls aren\'t used by this plugin, but jPlayer seems to require that they exist -->                <span class="unused-controls">                    <span class="jp-video-play"></span>                    <span class="jp-stop"></span>                    <span class="jp-mute"></span>                    <span class="jp-unmute"></span>                    <span class="jp-volume-bar"></span>                    <span class="jp-volume-bar-value"></span>                    <span class="jp-volume-max"></span>                    <span class="jp-current-time"></span>                    <span class="jp-duration"></span>                    <span class="jp-full-screen"></span>                    <span class="jp-restore-screen"></span>                    <span class="jp-repeat"></span>                    <span class="jp-repeat-off"></span>                    <span class="jp-gui"></span>                </span>            </div>            <div class="progress-wrapper">                <div class="progress jp-seek-bar">                    <div class="elapsed jp-play-bar"></div>                </div>            </div>        </div>    </div>    <div class="tracklist">        <ol class="tracks"> </ol>        <div class="more">View More...</div>    </div>    <div class="jPlayer-container"></div></div>';m=b(n).css({display:"none",opacity:0}).appendTo(D).slideDown("slow",function(){m.animate({opacity:1});D.trigger("mbInterfaceBuilt")})}function g(){l.html(K(H))}function i(){if(Q(J[H].artist)){j.parent(M.artistOuter).animate({opacity:0},"fast")}else{j.html(J[H].artist).parent(M.artistOuter).animate({opacity:1},"fast")}}function e(){h.animate({opacity:0},"fast",function(){if(!Q(J[H].cover)){var m=H;b('<img src="'+J[H].cover+'" alt="album cover" />',this).imagesLoaded(function(){if(m==H){h.html(b(this)).animate({opacity:1})}})}})}function d(){if(!Q(O.description)){D.find(M.description).html(O.description).addClass(F(M.descriptionShowing)).slideDown()}}return{buildInterface:c,init:k}};function K(c){if(!Q(J[c].title)){return J[c].title}else{if(!Q(J[c].mp3)){return a(J[c].mp3)}else{if(!Q(J[c].oga)){return a(J[c].oga)}else{return""}}}}function a(c){c=c.split("/");return c[c.length-1]}function P(e,d,c){if(e=="track"){if(!Q(J[c].rating)){E(d,J[c].rating)}}else{var f=!Q(J[c].rating)?Math.ceil(J[c].rating):0;I(f)}}function I(c){D.find(M.trackInfo).find(M.ratingLevel).removeClass(F(M.ratingLevelOn)).slice(0,c).addClass(F(M.ratingLevelOn))}function E(d,c){d.find(M.ratingLevel).removeClass(F(M.ratingLevelOn)).slice(0,c*1).addClass(F(M.ratingLevelOn))}function F(c){return c.substr(1)}function B(d){var c=Array.prototype.slice.call(arguments,1);if(b.isFunction(d)){d.apply(this,c)}}function Q(c){return typeof c=="undefined"}A()}})(jQuery);(function(b){b.fn.imagesLoaded=function(e){var f=this.filter("img"),a=f.length;f.bind("load",function(){if(--a<=0){e.call(f,this)}}).each(function(){if(this.complete||this.complete===undefined){var c=this.src;this.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";this.src=c}});return this}})(jQuery);